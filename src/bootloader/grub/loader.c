#include <stdint.h>

typedef unsigned long long size_t;
typedef struct {
	void* BaseAddress;
	size_t BufferSize;
	unsigned int Width;
	unsigned int Height;
	unsigned int PixelsPerScanLine;
    unsigned char strategy;
} GraphicsInfo;

void set_graphics_info(GraphicsInfo *gi);
GraphicsInfo *get_graphics_info();
void clear_screen(unsigned int colour);
void draw_pixel_at(unsigned int x,unsigned int y,unsigned int colour);
unsigned int get_pixel_at(unsigned int x,unsigned int y);
void printString(char* message);
void k_printf(char* format,...);
void initialise_graphics_driver();
void putc(char deze);
unsigned int create_colour_code(unsigned char red,unsigned char green,unsigned char blue,unsigned char alpha);
void repaint();
typedef struct {
	unsigned char magic[2];
	unsigned char mode;
	unsigned char charsize;
} PSF1_Header;

typedef struct {
	PSF1_Header* psf1_Header;
	void* glyphBuffer;
} PSF1_Font;

PSF1_Font* getDefaultFont();
void setActiveFont(PSF1_Font *av);
PSF1_Font *getActiveFont();
void drawCharacter(PSF1_Font *font,char character,unsigned int colour,unsigned long xOff,unsigned long yOff);

#ifndef MULTIBOOT_HEADER
#define MULTIBOOT_HEADER 1

/* How many bytes from the start of the file we search for the header. */
#define MULTIBOOT_SEARCH                        8192
#define MULTIBOOT_HEADER_ALIGN                  4

/* The magic field should contain this. */
#define MULTIBOOT_HEADER_MAGIC                  0x1BADB002

/* This should be in %eax. */
#define MULTIBOOT_BOOTLOADER_MAGIC              0x2BADB002

/* Alignment of multiboot modules. */
#define MULTIBOOT_MOD_ALIGN                     0x00001000

/* Alignment of the multiboot info structure. */
#define MULTIBOOT_INFO_ALIGN                    0x00000004

/* Flags set in the ’flags’ member of the multiboot header. */

/* Align all boot modules on i386 page (4KB) boundaries. */
#define MULTIBOOT_PAGE_ALIGN                    0x00000001

/* Must pass memory information to OS. */
#define MULTIBOOT_MEMORY_INFO                   0x00000002

/* Must pass video information to OS. */
#define MULTIBOOT_VIDEO_MODE                    0x00000004

/* This flag indicates the use of the address fields in the header. */
#define MULTIBOOT_AOUT_KLUDGE                   0x00010000

/* Flags to be set in the ’flags’ member of the multiboot info structure. */

/* is there basic lower/upper memory information? */
#define MULTIBOOT_INFO_MEMORY                   0x00000001
/* is there a boot device set? */
#define MULTIBOOT_INFO_BOOTDEV                  0x00000002
/* is the command-line defined? */
#define MULTIBOOT_INFO_CMDLINE                  0x00000004
/* are there modules to do something with? */
#define MULTIBOOT_INFO_MODS                     0x00000008

/* These next two are mutually exclusive */

/* is there a symbol table loaded? */
#define MULTIBOOT_INFO_AOUT_SYMS                0x00000010
/* is there an ELF section header table? */
#define MULTIBOOT_INFO_ELF_SHDR                 0X00000020

/* is there a full memory map? */
#define MULTIBOOT_INFO_MEM_MAP                  0x00000040

/* Is there drive info? */
#define MULTIBOOT_INFO_DRIVE_INFO               0x00000080

/* Is there a config table? */
#define MULTIBOOT_INFO_CONFIG_TABLE             0x00000100

/* Is there a boot loader name? */
#define MULTIBOOT_INFO_BOOT_LOADER_NAME         0x00000200

/* Is there a APM table? */
#define MULTIBOOT_INFO_APM_TABLE                0x00000400

/* Is there video information? */
#define MULTIBOOT_INFO_VBE_INFO                 0x00000800
#define MULTIBOOT_INFO_FRAMEBUFFER_INFO         0x00001000

#ifndef ASM_FILE

typedef unsigned char           multiboot_uint8_t;
typedef unsigned short          multiboot_uint16_t;
typedef unsigned int            multiboot_uint32_t;
typedef unsigned long long      multiboot_uint64_t;

struct multiboot_header
{
  /* Must be MULTIBOOT_MAGIC - see above. */
  multiboot_uint32_t magic;

  /* Feature flags. */
  multiboot_uint32_t flags;

  /* The above fields plus this one must equal 0 mod 2^32. */
  multiboot_uint32_t checksum;

  /* These are only valid if MULTIBOOT_AOUT_KLUDGE is set. */
  multiboot_uint32_t header_addr;
  multiboot_uint32_t load_addr;
  multiboot_uint32_t load_end_addr;
  multiboot_uint32_t bss_end_addr;
  multiboot_uint32_t entry_addr;

  /* These are only valid if MULTIBOOT_VIDEO_MODE is set. */
  multiboot_uint32_t mode_type;
  multiboot_uint32_t width;
  multiboot_uint32_t height;
  multiboot_uint32_t depth;
};

/* The symbol table for a.out. */
struct multiboot_aout_symbol_table
{
  multiboot_uint32_t tabsize;
  multiboot_uint32_t strsize;
  multiboot_uint32_t addr;
  multiboot_uint32_t reserved;
};
typedef struct multiboot_aout_symbol_table multiboot_aout_symbol_table_t;

/* The section header table for ELF. */
struct multiboot_elf_section_header_table
{
  multiboot_uint32_t num;
  multiboot_uint32_t size;
  multiboot_uint32_t addr;
  multiboot_uint32_t shndx;
};
typedef struct multiboot_elf_section_header_table multiboot_elf_section_header_table_t;

struct multiboot_info
{
  /* Multiboot info version number */
  multiboot_uint32_t flags;

  /* Available memory from BIOS */
  multiboot_uint32_t mem_lower;
  multiboot_uint32_t mem_upper;

  /* "root" partition */
  multiboot_uint32_t boot_device;

  /* Kernel command line */
  multiboot_uint32_t cmdline;

  /* Boot-Module list */
  multiboot_uint32_t mods_count;
  multiboot_uint32_t mods_addr;

  union
  {
    multiboot_aout_symbol_table_t aout_sym;
    multiboot_elf_section_header_table_t elf_sec;
  } u;

  /* Memory Mapping buffer */
  multiboot_uint32_t mmap_length;
  multiboot_uint32_t mmap_addr;

  /* Drive Info buffer */
  multiboot_uint32_t drives_length;
  multiboot_uint32_t drives_addr;

  /* ROM configuration table */
  multiboot_uint32_t config_table;

  /* Boot Loader Name */
  multiboot_uint32_t boot_loader_name;

  /* APM table */
  multiboot_uint32_t apm_table;

  /* Video */
  multiboot_uint32_t vbe_control_info;
  multiboot_uint32_t vbe_mode_info;
  multiboot_uint16_t vbe_mode;
  multiboot_uint16_t vbe_interface_seg;
  multiboot_uint16_t vbe_interface_off;
  multiboot_uint16_t vbe_interface_len;

  multiboot_uint64_t framebuffer_addr;
  multiboot_uint32_t framebuffer_pitch;
  multiboot_uint32_t framebuffer_width;
  multiboot_uint32_t framebuffer_height;
  multiboot_uint8_t framebuffer_bpp;
#define MULTIBOOT_FRAMEBUFFER_TYPE_INDEXED 0
#define MULTIBOOT_FRAMEBUFFER_TYPE_RGB     1
#define MULTIBOOT_FRAMEBUFFER_TYPE_EGA_TEXT     2
  multiboot_uint8_t framebuffer_type;
  union
  {
    struct
    {
      multiboot_uint32_t framebuffer_palette_addr;
      multiboot_uint16_t framebuffer_palette_num_colors;
    };
    struct
    {
      multiboot_uint8_t framebuffer_red_field_position;
      multiboot_uint8_t framebuffer_red_mask_size;
      multiboot_uint8_t framebuffer_green_field_position;
      multiboot_uint8_t framebuffer_green_mask_size;
      multiboot_uint8_t framebuffer_blue_field_position;
      multiboot_uint8_t framebuffer_blue_mask_size;
    };
  };
};
typedef struct multiboot_info multiboot_info_t;

struct multiboot_color
{
  multiboot_uint8_t red;
  multiboot_uint8_t green;
  multiboot_uint8_t blue;
};

struct multiboot_mmap_entry
{
  multiboot_uint32_t size;
  multiboot_uint32_t addr_low;
  multiboot_uint32_t addr_high;
  multiboot_uint32_t len_low;
  multiboot_uint32_t len_high;
#define MULTIBOOT_MEMORY_AVAILABLE              1
#define MULTIBOOT_MEMORY_RESERVED               2
#define MULTIBOOT_MEMORY_ACPI_RECLAIMABLE       3
#define MULTIBOOT_MEMORY_NVS                    4
#define MULTIBOOT_MEMORY_BADRAM                 5
  multiboot_uint32_t type;
} __attribute__((packed));
typedef struct multiboot_mmap_entry multiboot_memory_map_t;

struct multiboot_mod_list
{
  /* the memory used goes from bytes ’mod_start’ to ’mod_end-1’ inclusive */
  multiboot_uint32_t mod_start;
  multiboot_uint32_t mod_end;

  /* Module command line */
  multiboot_uint32_t cmdline;

  /* padding to take it to 16 bytes (must be zero) */
  multiboot_uint32_t pad;
};
typedef struct multiboot_mod_list multiboot_module_t;

/* APM BIOS info. */
struct multiboot_apm_info
{
  multiboot_uint16_t version;
  multiboot_uint16_t cseg;
  multiboot_uint32_t offset;
  multiboot_uint16_t cseg_16;
  multiboot_uint16_t dseg;
  multiboot_uint16_t flags;
  multiboot_uint16_t cseg_len;
  multiboot_uint16_t cseg_16_len;
  multiboot_uint16_t dseg_len;
};

#endif /* ! ASM_FILE */

#endif /* ! MULTIBOOT_HEADER */
#include <elf.h>

char default_psf[0x14c0] = {0x36,0x4,0x2,0x10,0x0,0x0,0x7e,0xc3,0x99,0x99,0xf3,0xe7,0xe7,0xff,0xe7,0xe7,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7f,0xe6,0x66,0x66,0x66,0x66,0xc3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0xc,0xfe,0x18,0x30,0xfe,0x60,0xc0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x60,0x30,0x18,0xc,0x0,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x30,0x18,0xc,0x6,0xc,0x18,0x30,0x0,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0x7c,0x7c,0x7c,0x7c,0x7c,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x7c,0xfe,0x7c,0x38,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0x60,0xe0,0x62,0x66,0x6c,0x18,0x30,0x66,0xce,0x96,0x3f,0x6,0x6,0x0,0x0,0x0,0x60,0xe0,0x62,0x66,0x6c,0x18,0x30,0x60,0xce,0x9b,0x6,0xc,0x1f,0x0,0x0,0x0,0xe0,0x30,0x62,0x36,0xec,0x18,0x30,0x66,0xce,0x96,0x3f,0x6,0x6,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc,0x6,0x7c,0x0,0x0,0x0,0xe,0x1b,0x18,0x18,0x18,0x7e,0x18,0x18,0x18,0x18,0x18,0xd8,0x70,0x0,0x0,0x0,0x18,0x18,0x18,0x7e,0x18,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x7e,0x18,0x18,0x7e,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc2,0xc6,0xc,0x18,0x30,0x60,0xdb,0x9b,0x0,0x0,0x0,0x0,0x0,0x0,0xf1,0x5b,0x55,0x51,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xdb,0xdb,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x18,0xc,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x30,0x18,0xc,0x18,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x66,0x33,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x66,0xcc,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x66,0xcc,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x66,0x33,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0xc,0x0,0x0,0x6c,0x38,0x0,0x3c,0x66,0xc2,0xc0,0xde,0xc6,0xc6,0x66,0x3a,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x38,0x0,0x76,0xcc,0xcc,0xcc,0xcc,0xcc,0x7c,0xc,0xcc,0x78,0x0,0x0,0x18,0x18,0x0,0x3c,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0x60,0x38,0xc,0x6,0xc6,0xc6,0x7c,0xc,0x6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0x60,0x38,0xc,0xc6,0x7c,0xc,0x6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x3c,0x3c,0x3c,0x18,0x18,0x18,0x0,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x66,0x24,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0xfe,0x6c,0x6c,0x6c,0xfe,0x6c,0x6c,0x0,0x0,0x0,0x0,0x0,0x10,0x10,0x7c,0xd6,0xd2,0xd0,0x7c,0x16,0x96,0xd6,0x7c,0x10,0x10,0x0,0x0,0x0,0x0,0x0,0x0,0xc2,0xc6,0xc,0x18,0x30,0x60,0xc6,0x86,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x6c,0x6c,0x38,0x76,0xdc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x30,0x30,0x30,0x30,0x30,0x18,0xc,0x0,0x0,0x0,0x0,0x0,0x0,0x30,0x18,0xc,0xc,0xc,0xc,0xc,0xc,0x18,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x38,0xfe,0x38,0x6c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x7e,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x2,0x6,0xc,0x18,0x30,0x60,0xc0,0x80,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0xd6,0xd6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x38,0x78,0x18,0x18,0x18,0x18,0x18,0x18,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0x6,0xc,0x18,0x30,0x60,0xc0,0xc6,0xfe,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0x6,0x6,0x3c,0x6,0x6,0x6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0xc,0x1c,0x3c,0x6c,0xcc,0xfe,0xc,0xc,0xc,0x1e,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0xc0,0xc0,0xc0,0xfc,0x6,0x6,0x6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x60,0xc0,0xc0,0xfc,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0xc6,0x6,0x6,0xc,0x18,0x30,0x30,0x30,0x30,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0x7c,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0x7e,0x6,0x6,0x6,0xc,0x78,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x0,0x0,0x0,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x0,0x0,0x0,0x18,0x18,0x18,0x30,0x0,0x0,0x0,0x0,0x0,0x6,0xc,0x18,0x30,0x60,0x30,0x18,0xc,0x6,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7e,0x0,0x0,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0xc,0x6,0xc,0x18,0x30,0x60,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc,0x18,0x18,0x18,0x0,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0xde,0xde,0xde,0xdc,0xc0,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x0,0x0,0xfc,0x66,0x66,0x66,0x7c,0x66,0x66,0x66,0x66,0xfc,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x66,0xc2,0xc0,0xc0,0xc0,0xc0,0xc2,0x66,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0xf8,0x6c,0x66,0x66,0x66,0x66,0x66,0x66,0x6c,0xf8,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0x66,0x62,0x68,0x78,0x68,0x60,0x62,0x66,0xfe,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0x66,0x62,0x68,0x78,0x68,0x60,0x60,0x60,0xf0,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x66,0xc2,0xc0,0xc0,0xde,0xc6,0xc6,0x66,0x3a,0x0,0x0,0x0,0x0,0x0,0x0,0xc6,0xc6,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x1e,0xc,0xc,0xc,0xc,0xc,0xcc,0xcc,0xcc,0x78,0x0,0x0,0x0,0x0,0x0,0x0,0xe6,0x66,0x66,0x6c,0x78,0x78,0x6c,0x66,0x66,0xe6,0x0,0x0,0x0,0x0,0x0,0x0,0xf0,0x60,0x60,0x60,0x60,0x60,0x60,0x62,0x66,0xfe,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xe7,0xff,0xff,0xdb,0xc3,0xc3,0xc3,0xc3,0xc3,0x0,0x0,0x0,0x0,0x0,0x0,0xc6,0xe6,0xf6,0xfe,0xde,0xce,0xc6,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0xfc,0x66,0x66,0x66,0x7c,0x60,0x60,0x60,0x60,0xf0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xd6,0xde,0x7c,0xc,0xe,0x0,0x0,0x0,0x0,0xfc,0x66,0x66,0x66,0x7c,0x6c,0x66,0x66,0x66,0xe6,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0x60,0x38,0xc,0x6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0xdb,0x99,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0x66,0x3c,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0xc3,0xc3,0xc3,0xdb,0xdb,0xff,0x66,0x66,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0x66,0x3c,0x18,0x18,0x3c,0x66,0xc3,0xc3,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0xc3,0x66,0x3c,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0xc3,0x86,0xc,0x18,0x30,0x60,0xc1,0xc3,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x30,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x80,0xc0,0x60,0x30,0x18,0xc,0x6,0x2,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0xc,0xc,0xc,0xc,0xc,0xc,0xc,0xc,0x3c,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0xc6,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0x0,0x0,0x0,0x18,0x18,0x18,0xc,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0xe0,0x60,0x60,0x78,0x6c,0x66,0x66,0x66,0x66,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc0,0xc0,0xc0,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x1c,0xc,0xc,0x3c,0x6c,0xcc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xfe,0xc0,0xc0,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x6c,0x64,0x60,0xf0,0x60,0x60,0x60,0x60,0xf0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0xcc,0xcc,0xcc,0xcc,0xcc,0x7c,0xc,0xcc,0x78,0x0,0x0,0x0,0xe0,0x60,0x60,0x6c,0x76,0x66,0x66,0x66,0x66,0xe6,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x6,0x6,0x0,0xe,0x6,0x6,0x6,0x6,0x6,0x6,0x66,0x66,0x3c,0x0,0x0,0x0,0xe0,0x60,0x60,0x66,0x6c,0x78,0x78,0x6c,0x66,0xe6,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xe6,0xff,0xdb,0xdb,0xdb,0xdb,0xdb,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xdc,0x66,0x66,0x66,0x66,0x66,0x66,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xdc,0x66,0x66,0x66,0x66,0x66,0x7c,0x60,0x60,0xf0,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0xcc,0xcc,0xcc,0xcc,0xcc,0x7c,0xc,0xc,0x1e,0x0,0x0,0x0,0x0,0x0,0x0,0xdc,0x76,0x66,0x60,0x60,0x60,0xf0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0x60,0x38,0xc,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x30,0x30,0xfc,0x30,0x30,0x30,0x30,0x36,0x1c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xcc,0xcc,0xcc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0xc3,0xc3,0x66,0x3c,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0xc3,0xdb,0xdb,0xff,0x66,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0x66,0x3c,0x18,0x3c,0x66,0xc3,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7e,0x6,0xc,0xf8,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0xcc,0x18,0x30,0x60,0xc6,0xfe,0x0,0x0,0x0,0x0,0x0,0x0,0xe,0x18,0x18,0x18,0x70,0x18,0x18,0x18,0x18,0xe,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x70,0x18,0x18,0x18,0xe,0x18,0x18,0x18,0x18,0x70,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x3c,0x3c,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x38,0x6c,0x38,0x10,0x38,0x6c,0xc6,0xc6,0xfe,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x0,0x0,0x3f,0x6d,0xcc,0xcc,0xff,0xcc,0xcc,0xcc,0xcd,0xcf,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x66,0xc2,0xc0,0xc0,0xc0,0xc0,0xc2,0x66,0x3c,0xc,0x6,0x7c,0x0,0x60,0x30,0x18,0x0,0xfe,0x62,0x68,0x78,0x68,0x60,0x62,0xfe,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0xfe,0x62,0x68,0x78,0x68,0x60,0x62,0xfe,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0xfe,0x62,0x68,0x78,0x68,0x60,0x62,0xfe,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0xfe,0x62,0x68,0x78,0x68,0x60,0x62,0xfe,0x0,0x0,0x0,0x0,0x30,0x18,0xc,0x0,0x3c,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x3c,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x3c,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x0,0x3c,0x18,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0xf8,0x6c,0x66,0x66,0xf6,0x66,0x66,0x66,0x6c,0xf8,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0xc6,0xe6,0xf6,0xfe,0xde,0xce,0xc6,0xc6,0xc6,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xc6,0x6c,0x38,0x6c,0xc6,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3d,0x67,0x66,0x6e,0x7e,0x76,0x66,0x66,0xe6,0xbc,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0xc3,0xc3,0x66,0x3c,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0xf0,0x60,0x7c,0x66,0x66,0x66,0x66,0x7c,0x60,0xf0,0x0,0x0,0x0,0x0,0x0,0x0,0x78,0xcc,0xcc,0xcc,0xd8,0xcc,0xc6,0xc6,0xc6,0xcc,0x0,0x0,0x0,0x0,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0xaa,0x55,0x0,0x0,0x18,0x18,0x0,0x18,0x18,0x18,0x3c,0x3c,0x3c,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x10,0x7c,0xd6,0xd0,0xd0,0xd0,0xd6,0x7c,0x10,0x0,0x0,0x0,0x0,0x38,0x6c,0x64,0x60,0x60,0xf0,0x60,0x60,0x60,0x66,0xfc,0x0,0x0,0x0,0x0,0x0,0x0,0x1e,0x33,0x60,0xfc,0x60,0xf8,0x60,0x60,0x33,0x1e,0x0,0x0,0x0,0x0,0x0,0x0,0xc3,0xc3,0x66,0x3c,0x18,0x7e,0x18,0x7e,0x18,0x18,0x0,0x0,0x0,0x0,0x6c,0x38,0x10,0x7c,0xc6,0xc6,0x60,0x38,0xc,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0x60,0x38,0x6c,0xc6,0xc6,0x6c,0x38,0xc,0xc6,0x7c,0x0,0x0,0x0,0x0,0x6c,0x38,0x10,0x0,0x7c,0xc6,0x60,0x38,0xc,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x42,0x99,0xa5,0xa1,0xa1,0xa5,0x99,0x42,0x3c,0x0,0x0,0x0,0x0,0x0,0x3c,0x6c,0x6c,0x3e,0x0,0x7e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x36,0x6c,0xd8,0x6c,0x36,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0x6,0x6,0x6,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0x3c,0x66,0x66,0x66,0x3c,0x66,0x0,0x0,0x0,0x0,0x0,0x0,0x3c,0x42,0xb9,0xa5,0xb9,0xa5,0x42,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x6c,0x6c,0x38,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x7e,0x18,0x18,0x0,0x7e,0x0,0x0,0x0,0x0,0x0,0x38,0x6c,0x18,0x30,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x78,0xc,0x38,0xc,0x78,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x38,0x10,0xff,0xc3,0x86,0xc,0x18,0x30,0x61,0xc3,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x66,0x66,0x66,0x66,0x7b,0x60,0x60,0xc0,0x0,0x0,0x0,0x7f,0xdb,0xdb,0xdb,0x7b,0x1b,0x1b,0x1b,0x1b,0x1b,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x38,0x10,0x0,0xfe,0xcc,0x18,0x30,0x60,0xc6,0xfe,0x0,0x0,0x0,0x0,0x0,0x18,0x38,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x38,0x6c,0x6c,0x6c,0x38,0x0,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xd8,0x6c,0x36,0x6c,0xd8,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7f,0xcd,0xcc,0xcc,0xcf,0xcc,0xcc,0xcc,0xcd,0x7f,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7e,0xdb,0xdb,0xdf,0xd8,0xdb,0x7e,0x0,0x0,0x0,0x0,0x0,0x66,0x66,0x0,0xc3,0xc3,0x66,0x3c,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x30,0x30,0x0,0x30,0x30,0x30,0x60,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x1f,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xf8,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1f,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xf8,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x1f,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xf8,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0xff,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x88,0x22,0x88,0x22,0x88,0x22,0x88,0x22,0x88,0x22,0x88,0x22,0x88,0x22,0x88,0x22,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x0,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x0,0x0,0x0,0x0,0x0,0x0,0x3f,0x30,0x37,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x0,0x0,0x0,0x0,0x0,0x0,0xfe,0x6,0xf6,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x37,0x30,0x3f,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x36,0x36,0x36,0x36,0x36,0x36,0xf6,0x6,0xfe,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x36,0x36,0x36,0x36,0x36,0x36,0x37,0x30,0x37,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xf6,0x6,0xf6,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x0,0x0,0x0,0x0,0x0,0x0,0xff,0x0,0xf7,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xf7,0x0,0xff,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x36,0x36,0x36,0x36,0x36,0x36,0xf7,0x0,0xf7,0x36,0x36,0x36,0x36,0x36,0x36,0x36,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x0,0x0,0x18,0x3c,0x7e,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x18,0x18,0x18,0x18,0x18,0x7e,0x3c,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x30,0x7f,0x30,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0xc,0xfe,0xc,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x38,0x6c,0x38,0x0,0x78,0xc,0x7c,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0x1b,0x7b,0xdf,0xd8,0xdb,0x6e,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x7c,0xc6,0xc0,0xc0,0xc0,0xc6,0x7c,0xc,0x6,0x7c,0x0,0x0,0x60,0x30,0x18,0x0,0x7c,0xc6,0xfe,0xc0,0xc0,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x7c,0xc6,0xfe,0xc0,0xc0,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x7c,0xc6,0xfe,0xc0,0xc0,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x7c,0xc6,0xfe,0xc0,0xc0,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x38,0x18,0x18,0x18,0x18,0x18,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x34,0x18,0x2c,0x6,0x3e,0x66,0x66,0x66,0x66,0x3c,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0xdc,0x66,0x66,0x66,0x66,0x66,0x66,0x0,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x76,0xdc,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0x7c,0xc6,0xc6,0xc6,0xc6,0xc6,0x7c,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x18,0x18,0x0,0x7e,0x0,0x18,0x18,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x0,0x3d,0x67,0x6e,0x7e,0x76,0xe6,0xbc,0x0,0x0,0x0,0x0,0x0,0x60,0x30,0x18,0x0,0xcc,0xcc,0xcc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0xcc,0xcc,0xcc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x10,0x38,0x6c,0x0,0xcc,0xcc,0xcc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0x0,0x6c,0x6c,0x0,0xcc,0xcc,0xcc,0xcc,0xcc,0xcc,0x76,0x0,0x0,0x0,0x0,0x0,0xc,0x18,0x30,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7e,0x6,0xc,0xf8,0x0,0x0,0x0,0xe0,0x60,0x60,0x7c,0x66,0x66,0x66,0x66,0x66,0x7c,0x60,0x60,0xf0,0x0,0x0,0x0,0x6c,0x6c,0x0,0xc6,0xc6,0xc6,0xc6,0xc6,0xc6,0x7e,0x6,0xc,0xf8,0x0,0xfd,0xff,0xff,0xff,0xc0,0x3,0xff,0xff,0x60,0x22,0xff,0xff,0x64,0x22,0xff,0xff,0x65,0x22,0xff,0xff,0xa0,0x25,0xac,0x25,0xae,0x25,0xfc,0x25,0xfe,0x25,0x1b,0x2b,0xe,0x22,0xff,0xff,0xc6,0x25,0x66,0x26,0x25,0x2b,0x27,0x2b,0xff,0xff,0xbc,0x0,0xff,0xff,0xbd,0x0,0xff,0xff,0xbe,0x0,0xff,0xff,0xa6,0x0,0xff,0xff,0xa8,0x0,0xff,0xff,0xb8,0x0,0xff,0xff,0x92,0x1,0xff,0xff,0x20,0x20,0xff,0xff,0x21,0x20,0xff,0xff,0x30,0x20,0xff,0xff,0x22,0x21,0xff,0xff,0x26,0x20,0xff,0xff,0x39,0x20,0xff,0xff,0x3a,0x20,0xff,0xff,0x1c,0x20,0x1f,0x20,0x36,0x20,0xff,0xff,0x1d,0x20,0xba,0x2,0xdd,0x2,0xee,0x2,0x33,0x20,0xff,0xff,0x1e,0x20,0xff,0xff,0x42,0x2e,0xff,0xff,0x41,0x2e,0xce,0x2,0xff,0xff,0x1e,0x1,0xff,0xff,0x1f,0x1,0xff,0xff,0x30,0x1,0xff,0xff,0x31,0x1,0xff,0xff,0x5e,0x1,0xff,0xff,0x5f,0x1,0xff,0xff,0x20,0x0,0xa0,0x0,0x0,0x20,0x1,0x20,0x2,0x20,0x3,0x20,0x4,0x20,0x5,0x20,0x6,0x20,0x7,0x20,0x8,0x20,0x9,0x20,0xa,0x20,0x2f,0x20,0x5f,0x20,0xff,0xff,0x21,0x0,0xff,0xff,0x22,0x0,0xff,0xff,0x23,0x0,0xff,0xff,0x24,0x0,0xff,0xff,0x25,0x0,0xff,0xff,0x26,0x0,0xff,0xff,0x27,0x0,0xb4,0x0,0xb9,0x2,0xbc,0x2,0xca,0x2,0x19,0x20,0x32,0x20,0xff,0xff,0x28,0x0,0xff,0xff,0x29,0x0,0xff,0xff,0x2a,0x0,0x4e,0x20,0x17,0x22,0xff,0xff,0x2b,0x0,0xff,0xff,0x2c,0x0,0xcf,0x2,0x1a,0x20,0xff,0xff,0x2d,0x0,0xad,0x0,0x10,0x20,0x11,0x20,0x12,0x20,0x13,0x20,0x43,0x20,0x12,0x22,0xff,0xff,0x2e,0x0,0x24,0x20,0xff,0xff,0x2f,0x0,0x44,0x20,0x15,0x22,0xff,0xff,0x30,0x0,0xff,0xff,0x31,0x0,0xff,0xff,0x32,0x0,0xff,0xff,0x33,0x0,0xff,0xff,0x34,0x0,0xff,0xff,0x35,0x0,0xff,0xff,0x36,0x0,0xff,0xff,0x37,0x0,0xff,0xff,0x38,0x0,0xff,0xff,0x39,0x0,0xff,0xff,0x3a,0x0,0x36,0x22,0xff,0xff,0x3b,0x0,0xff,0xff,0x3c,0x0,0xff,0xff,0x3d,0x0,0x40,0x2e,0xff,0xff,0x3e,0x0,0xff,0xff,0x3f,0x0,0xff,0xff,0x40,0x0,0xff,0xff,0x41,0x0,0xff,0xff,0x42,0x0,0xff,0xff,0x43,0x0,0xff,0xff,0x44,0x0,0xff,0xff,0x45,0x0,0xff,0xff,0x46,0x0,0xff,0xff,0x47,0x0,0xff,0xff,0x48,0x0,0xff,0xff,0x49,0x0,0xff,0xff,0x4a,0x0,0xff,0xff,0x4b,0x0,0x2a,0x21,0xff,0xff,0x4c,0x0,0xff,0xff,0x4d,0x0,0xff,0xff,0x4e,0x0,0xff,0xff,0x4f,0x0,0xff,0xff,0x50,0x0,0xff,0xff,0x51,0x0,0xff,0xff,0x52,0x0,0xff,0xff,0x53,0x0,0xff,0xff,0x54,0x0,0xff,0xff,0x55,0x0,0xff,0xff,0x56,0x0,0xff,0xff,0x57,0x0,0xff,0xff,0x58,0x0,0xff,0xff,0x59,0x0,0xff,0xff,0x5a,0x0,0xff,0xff,0x5b,0x0,0xff,0xff,0x5c,0x0,0xf5,0x29,0xff,0xff,0x5d,0x0,0xff,0xff,0x5e,0x0,0xc4,0x2,0xc6,0x2,0x3,0x23,0xff,0xff,0x5f,0x0,0xff,0xff,0x60,0x0,0xbb,0x2,0xbd,0x2,0xcb,0x2,0x18,0x20,0x1b,0x20,0x35,0x20,0xff,0xff,0x61,0x0,0xff,0xff,0x62,0x0,0xff,0xff,0x63,0x0,0xff,0xff,0x64,0x0,0xff,0xff,0x65,0x0,0xff,0xff,0x66,0x0,0xff,0xff,0x67,0x0,0xff,0xff,0x68,0x0,0xff,0xff,0x69,0x0,0xff,0xff,0x6a,0x0,0xff,0xff,0x6b,0x0,0xff,0xff,0x6c,0x0,0xff,0xff,0x6d,0x0,0xff,0xff,0x6e,0x0,0xff,0xff,0x6f,0x0,0xff,0xff,0x70,0x0,0xff,0xff,0x71,0x0,0xff,0xff,0x72,0x0,0xff,0xff,0x73,0x0,0xff,0xff,0x74,0x0,0xff,0xff,0x75,0x0,0xff,0xff,0x76,0x0,0xff,0xff,0x77,0x0,0xff,0xff,0x78,0x0,0xff,0xff,0x79,0x0,0xff,0xff,0x7a,0x0,0xff,0xff,0x7b,0x0,0xff,0xff,0x7c,0x0,0x23,0x22,0xff,0xff,0x7d,0x0,0xff,0xff,0x7e,0x0,0xdc,0x2,0xff,0xff,0x22,0x20,0x19,0x22,0xcf,0x25,0xff,0xff,0xc0,0x0,0xff,0xff,0xc1,0x0,0xff,0xff,0xc2,0x0,0xff,0xff,0xc3,0x0,0xff,0xff,0xc4,0x0,0xff,0xff,0xc5,0x0,0x2b,0x21,0xff,0xff,0xc6,0x0,0xff,0xff,0xc7,0x0,0xff,0xff,0xc8,0x0,0xff,0xff,0xc9,0x0,0xff,0xff,0xca,0x0,0xff,0xff,0xcb,0x0,0xff,0xff,0xcc,0x0,0xff,0xff,0xcd,0x0,0xff,0xff,0xce,0x0,0xff,0xff,0xcf,0x0,0xff,0xff,0xd0,0x0,0x10,0x1,0xff,0xff,0xd1,0x0,0xff,0xff,0xd2,0x0,0xff,0xff,0xd3,0x0,0xff,0xff,0xd4,0x0,0xff,0xff,0xd5,0x0,0xff,0xff,0xd6,0x0,0xff,0xff,0xd7,0x0,0xff,0xff,0xd8,0x0,0xff,0xff,0xd9,0x0,0xff,0xff,0xda,0x0,0xff,0xff,0xdb,0x0,0xff,0xff,0xdc,0x0,0xff,0xff,0xdd,0x0,0xff,0xff,0xde,0x0,0xff,0xff,0xdf,0x0,0xff,0xff,0x92,0x25,0xff,0xff,0xa1,0x0,0xff,0xff,0xa2,0x0,0xff,0xff,0xa3,0x0,0xff,0xff,0xac,0x20,0xff,0xff,0xa5,0x0,0xff,0xff,0x60,0x1,0xff,0xff,0xa7,0x0,0xff,0xff,0x61,0x1,0xff,0xff,0xa9,0x0,0xff,0xff,0xaa,0x0,0xff,0xff,0xab,0x0,0xff,0xff,0xac,0x0,0xff,0xff,0xa4,0x0,0xff,0xff,0xae,0x0,0xff,0xff,0xaf,0x0,0xc9,0x2,0xff,0xff,0xb0,0x0,0xda,0x2,0xff,0xff,0xb1,0x0,0xff,0xff,0xb2,0x0,0xff,0xff,0xb3,0x0,0xff,0xff,0x7d,0x1,0xff,0xff,0xb5,0x0,0xbc,0x3,0xff,0xff,0xb6,0x0,0xff,0xff,0xb7,0x0,0x27,0x20,0xc5,0x22,0x31,0x2e,0xff,0xff,0x7e,0x1,0xff,0xff,0xb9,0x0,0xff,0xff,0xba,0x0,0xff,0xff,0xbb,0x0,0xff,0xff,0x52,0x1,0xff,0xff,0x53,0x1,0xff,0xff,0x78,0x1,0xff,0xff,0xbf,0x0,0xff,0xff,0x0,0x25,0x14,0x20,0x15,0x20,0xaf,0x23,0xff,0xff,0x2,0x25,0xff,0xff,0xc,0x25,0x6d,0x25,0xff,0xff,0x10,0x25,0x6e,0x25,0xff,0xff,0x14,0x25,0x70,0x25,0xff,0xff,0x18,0x25,0x6f,0x25,0xff,0xff,0x1c,0x25,0xff,0xff,0x24,0x25,0xff,0xff,0x2c,0x25,0xff,0xff,0x34,0x25,0xff,0xff,0x3c,0x25,0xff,0xff,0x91,0x25,0xff,0xff,0xba,0x23,0x3e,0x20,0xff,0xff,0xbb,0x23,0xff,0xff,0xbc,0x23,0xff,0xff,0xbd,0x23,0xff,0xff,0x50,0x25,0x1,0x25,0xff,0xff,0x51,0x25,0x3,0x25,0xff,0xff,0x54,0x25,0xf,0x25,0xff,0xff,0x57,0x25,0x13,0x25,0xff,0xff,0x5a,0x25,0x17,0x25,0xff,0xff,0x5d,0x25,0x1b,0x25,0xff,0xff,0x60,0x25,0x23,0x25,0xff,0xff,0x63,0x25,0x2b,0x25,0xff,0xff,0x66,0x25,0x33,0x25,0xff,0xff,0x69,0x25,0x3b,0x25,0xff,0xff,0x6c,0x25,0x4b,0x25,0xff,0xff,0x88,0x25,0xff,0xff,0x91,0x21,0xff,0xff,0x93,0x21,0xff,0xff,0x90,0x21,0xff,0xff,0x92,0x21,0xff,0xff,0xe0,0x0,0xff,0xff,0xe1,0x0,0xff,0xff,0xe2,0x0,0xff,0xff,0xe3,0x0,0xff,0xff,0xe4,0x0,0xff,0xff,0xe5,0x0,0xff,0xff,0xe6,0x0,0xff,0xff,0xe7,0x0,0xff,0xff,0xe8,0x0,0xff,0xff,0xe9,0x0,0xff,0xff,0xea,0x0,0xff,0xff,0xeb,0x0,0xff,0xff,0xec,0x0,0xff,0xff,0xed,0x0,0xff,0xff,0xee,0x0,0xff,0xff,0xef,0x0,0xff,0xff,0xf0,0x0,0xff,0xff,0xf1,0x0,0xff,0xff,0xf2,0x0,0xff,0xff,0xf3,0x0,0xff,0xff,0xf4,0x0,0xff,0xff,0xf5,0x0,0xff,0xff,0xf6,0x0,0xff,0xff,0xf7,0x0,0xff,0xff,0xf8,0x0,0xff,0xff,0xf9,0x0,0xff,0xff,0xfa,0x0,0xff,0xff,0xfb,0x0,0xff,0xff,0xfc,0x0,0xff,0xff,0xfd,0x0,0xff,0xff,0xfe,0x0,0xff,0xff,0xff,0x0,0xff,0xff};

char* getDefaultPSFFontBuffer(){
    return (unsigned char*)&default_psf;
}

PSF1_Font default_font;

PSF1_Font* getDefaultFont(){
    char* dfb = getDefaultPSFFontBuffer();
    default_font.psf1_Header = (PSF1_Header*)(dfb);
    default_font.glyphBuffer = (void *)(dfb + sizeof(PSF1_Header));
    return (PSF1_Font *)&default_font;
}

PSF1_Font *active_font;

void setActiveFont(PSF1_Font *av){
    active_font = av;
}

PSF1_Font *getActiveFont(){
    return active_font;
}

void drawCharacter(PSF1_Font *font,char character,unsigned int colour,unsigned long xOff,unsigned long yOff){
    char* fontPtr = font->glyphBuffer + (character * font->psf1_Header->charsize);
    for (unsigned long y = yOff; y < yOff + font->psf1_Header->charsize; y++){
        for (unsigned long x = xOff; x < xOff+8; x++){
            if ((*fontPtr & (0b10000000 >> (x - xOff))) > 0){
                    draw_pixel_at(x,y,colour);
            }

        }
        fontPtr++;
    }
}

GraphicsInfo *graphics_info;

unsigned int* getMouseCoordinates();

void set_graphics_info(GraphicsInfo *gi){
    graphics_info = gi;
}

GraphicsInfo *get_graphics_info(){
    return graphics_info;
}

void draw_pixel_at(unsigned int x,unsigned int y,unsigned int colour){
    unsigned int BBP = 4;
    *(unsigned int*)((x*BBP) +(y*graphics_info->PixelsPerScanLine*BBP) + graphics_info->BaseAddress) = colour;
}

unsigned int get_pixel_at(unsigned int x,unsigned int y){
    unsigned int BBP = 4;
    return *(unsigned int*)((x*BBP) +(y*graphics_info->PixelsPerScanLine*BBP) + graphics_info->BaseAddress);
}

unsigned long pointerX = 50;
unsigned long pointerY = 50;

unsigned int create_colour_code(unsigned char red,unsigned char green,unsigned char blue,unsigned char alpha){
    return (alpha<<23) | (red<<16) | (green<<8) | blue;
}

void clear_screen(unsigned int colour){
      unsigned int BBP = 4;
      for(unsigned int y = 0 ; y < graphics_info->Height ; y++){
          for(unsigned int x = 0 ; x < graphics_info->Width ; x++){
              draw_pixel_at(x,y,colour);
          }
      }
      pointerX = 50;
      pointerY = 50;
}

void putc(char deze){
    if(graphics_info->strategy==1){
        if(pointerY>(graphics_info->Height-50)){
            clear_screen(0xFFFFFFFF);
            pointerX = 50;
            pointerY = 50;
        }
        if(deze=='\n'||pointerX>(graphics_info->Width-50)){
            pointerX = 50;
            pointerY += 16;
        }else{
            drawCharacter(getActiveFont(),deze,0x00000000,pointerX,pointerY);
            pointerX += 8;
        }
    }else{
        if(pointerY>=25){
            pointerX = 0;
            pointerY = 0;
        }
        if(deze=='\n'){
            pointerX = 0;
            pointerY++;
            return;
        }
        ((char*)(graphics_info->BaseAddress+(160*pointerY)+(pointerX*2)))[0] = deze;
        pointerX++;
        if(pointerX==80){
            pointerX = 0;
            pointerY++;
        }
    }
}

void printString(char* message){
    int length = 0;
    while(1){
        char deze = message[length];
        if(deze=='\0'){
            break;
        }else{
            putc(deze);
        }
        length++;
    }
}

typedef __builtin_va_list va_list;

#define va_start(a,b)  __builtin_va_start(a,b)
#define va_end(a)      __builtin_va_end(a)
#define va_arg(a,b)    __builtin_va_arg(a,b)
#define __va_copy(d,s) __builtin_va_copy((d),(s))

#define NULL (void*)0

char *convert(unsigned int num, int base) {
	static char Representation[]= "0123456789ABCDEF";
	static char buffer[50];
	char *ptr;

    for(int i = 0 ; i < 50 ; i++){
        buffer[i] = 0x00;
    }

	if(num==0){
		ptr = &buffer[0];
		buffer[0] = '0';
		buffer[1] = 0;
		return ptr;
	}

	ptr = &buffer[49];
	*--ptr = '\0';
	*--ptr = '\0';
	*--ptr = '\0';

	do
	{
		*--ptr = Representation[num%base];
		num /= base;
	}while(num != 0);

	return(ptr);
}

void k_printf(char* format,...){
    va_list arg;
	va_start(arg, format);
    int length = 0;
    while(1){
        char deze = format[length];
        if(deze=='\0'){
            break;
        }else if(deze=='%'){
            length++;
            deze = format[length];
            if(deze=='c'){
                char i = va_arg(arg,int);
                putc(i);
            }else if(deze=='%'){
                putc('%');
            }else if(deze=='s'){
                char *s = va_arg(arg,char *);
                printString(s);
            }else if(deze=='x'){
                int t = va_arg(arg,unsigned int);
                putc('0');
                putc('x');
                char *convertednumber = convert(t,16);
                printString(convertednumber);
            }else if(deze=='d'){
                int t = va_arg(arg,unsigned int);
                char *convertednumber = convert(t,10);
                printString(convertednumber);
            }else if(deze=='o'){
                int t = va_arg(arg,unsigned int);
                char *convertednumber = convert(t,8);
                printString(convertednumber);
            }
            length++;
        }else{
            putc(deze);
            length++;
        }
    }
    va_end(arg);
}


void initialise_graphics_driver(){
    clear_screen(0xFFFFFFFF);
    setActiveFont(getDefaultFont());
    k_printf("Graphics driver initialised!\nBase Address: %x\nHeight: %x \nPixelsPerScanline: %x \nWidth: %x \n",graphics_info->BaseAddress,graphics_info->Height,graphics_info->PixelsPerScanLine,graphics_info->Width);
}

typedef struct {
    uint32_t                          Type;           // Field size is 32 bits followed by 32 bit pad
    uint32_t                          Pad;
    uint64_t                        PhysicalStart;  // Field size is 64 bits
    uint64_t                        VirtualStart;   // Field size is 64 bits
    uint64_t                        NumberOfPages;  // Field size is 64 bits
    uint64_t                        Attribute;      // Field size is 64 bits
} MemoryDescriptor;

typedef struct{
    uint64_t mMap;
	uint64_t mMapSize;
	uint64_t mMapDescSize;
}MemoryInfo;

typedef struct {
	uint64_t BaseAddress;
	uint64_t BufferSize;
	uint32_t Width;
	uint32_t Height;
	uint32_t PixelsPerScanLine;
    uint8_t strategy;
	uint64_t pointerX;
	uint64_t pointerY;
} GraphicsInfo2;

typedef struct{
    uint32_t ip;
    uint32_t cs;
    uint32_t flags;
    uint32_t sp;
    uint32_t ss;
}interrupt_frame;

/**
 * @brief Bootinfo structure given by the program that booted us
 *
 */
typedef struct{

	/**
	 * @brief Graphicsinfo from the current device, like screensize, bytes per pixel, etc
	 *
	 */
	uint64_t graphics_info;

	/**
	 * @brief Fontfile that is used by the bootloader
	 *
	 */
	uint64_t font;

	/**
	 * @brief Memoryinfo with memorymap of the free memory which is present
	 *
	 */
	uint64_t memory_info;

	/**
	 * @brief Information table of which devices are present on this system
	 *
	 */
	uint64_t rsdp;
} BootInfo;

BootInfo bootinfo;
MemoryInfo memoryinfo;
GraphicsInfo2 graphicsinfo;

uint64_t table_index = 0x11000;
uint32_t table0_index;
uint64_t kernellocation = 0;
uint64_t stublocation = 0;

// thanks https://github.com/nelsoncole/sirius-x86-64/blob/main/boot/stage2/lib/string.c
void *memset(void *s, char val, size_t count)
{
	size_t _count = count;
    unsigned char *tmp = (unsigned char *)s;
    for(; _count != 0; _count--) *tmp++ = val;
    return s;

}

// thanks https://github.com/nelsoncole/sirius-x86-64/blob/main/boot/stage2/lib/string.c
void *memcpy(void * restrict s1, const void * restrict s2, size_t n)
{
	size_t p    = n;
	char *p_dest = (char*)s1;
	char *p_src  = (char*)s2;

	while(p--)
	*p_dest++ = *p_src++;
	return s1;
}

uint32_t getPagingAddress(){
    uint32_t uwu = table_index;
    memset((void*) uwu,0,4096*2);
    table_index += 0x1000;
    return uwu;
}

void page_specific_memory_address(uint64_t memaddress){
    int memarea_A = 0;
    int memarea_B = 0;
    int memarea_C = 0;
    int memarea_D = 0;
    memaddress &= 0xfffffffffffff000;//0xFFFFF000;
    uint64_t uuuu = memaddress;
    uuuu >>= 12;
    memarea_D = uuuu & 0x1ff;
    uuuu >>= 9;
    memarea_C = uuuu & 0x1ff;
    uuuu >>= 9;
    memarea_B = uuuu & 0x1ff;
    uuuu >>= 9;
    memarea_A = uuuu & 0x1ff;
    if(((uint64_t*)(uint32_t)table0_index)[memarea_A]==0){
        ((uint64_t*)(uint32_t)table0_index)[memarea_A] = getPagingAddress() | 3;
    }
    uint64_t table1_index = ((uint64_t*)(uint32_t)table0_index)[memarea_A] & 0xFFFFF000;

    if(((uint64_t*)(uint32_t)table1_index)[memarea_B]==0){
        ((uint64_t*)(uint32_t)table1_index)[memarea_B] = getPagingAddress() | 3;
    }
    uint64_t table2_index = ((uint64_t*)(uint32_t)table1_index)[memarea_B] & 0xFFFFF000;

    if(((uint64_t*)(uint32_t)table2_index)[memarea_C]==0){
        ((uint64_t*)(uint32_t)table2_index)[memarea_C] = getPagingAddress() | 3;
    }
    uint64_t table3_index = ((uint64_t*)(uint32_t)table2_index)[memarea_C] & 0xFFFFF000;
    ((uint64_t*)(uint32_t)table3_index)[memarea_D] = (memaddress & (~ 0x800fff0000000000)) | 3;
}

void definememoryrange(void* van,void *naar){
    for(void* u = van ; u < naar ; u += 0x1000){
        page_specific_memory_address((uint64_t)(uint32_t)u);
    }
}

void outportb(uint16_t port, uint8_t value){
    asm volatile ("outb %0, %1" : : "a"(value), "Nd"(port));
}

void __stack_chk_fail(){
    for(;;);
}

void __stack_chk_fail_local(){
    for(;;);
}

uint32_t strlen(uint8_t* message){
    uint32_t res = 0;
    uint8_t this = 1;
    while(this){
        this = message[res++];
    }
    return res;
}

uint32_t strcmp(uint8_t* a, uint8_t* b){
    uint32_t length = strlen(b);
	for (uint32_t i = 0; i < length; i++){
		if (*a != *b) return 0;
        a++;
        b++;
	}
	return 1;
}

void inspectGrubModule(struct multiboot_mod_list* modinformation){
    // dump general mod information
    k_printf("commandline: %s \n",modinformation->cmdline);
    k_printf("padding: %x \n",modinformation->pad);
    k_printf("mod: start:%x end:%x \n",modinformation->mod_start,modinformation->mod_end);
    multiboot_uint32_t imagesize = modinformation->mod_end - modinformation->mod_start;
    k_printf("the size of the mod is %x \n",imagesize);
    // check about the mod itself
    Elf64_Ehdr* elfheader = (Elf64_Ehdr*) modinformation->mod_start;
    k_printf("filetype : %d \n",elfheader->e_type);
    k_printf("machine  : %d \n",elfheader->e_machine);
    k_printf("version  : %d \n",elfheader->e_version);
    k_printf("entry    : %x \n",elfheader->e_entry);
    if(strcmp((char*)modinformation->cmdline,"kernel")){
        kernellocation = elfheader->e_entry;
    }
    if(strcmp((char*)modinformation->cmdline,"stub")){
        stublocation = elfheader->e_entry;
    }
    k_printf("ph count : %d \n",elfheader->e_phnum);
    // get the program headers
    for(Elf64_Half i = 0 ; i < elfheader->e_phnum ; i++){
        void *memoryregion = (void*) ( modinformation->mod_start + ((uint32_t)elfheader->e_phoff) + (sizeof(Elf64_Phdr) * i));
        Elf64_Phdr* programheader = (Elf64_Phdr*) ( memoryregion );
        if(programheader->p_type==PT_LOAD){
            uint32_t vaddr = (uint32_t)programheader->p_vaddr;
            uint32_t poff = (uint32_t)modinformation->mod_start + programheader->p_offset;
            k_printf(
                "header %d : offset: %x virtaddr: %x paddr: %x filesz: %x memsz: %x \n",
                i,
                poff,
                vaddr,
                (uint32_t) programheader->p_paddr,
                (uint32_t) programheader->p_filesz,
                (uint32_t) programheader->p_memsz
            );
            definememoryrange((void*)vaddr,(void*)(vaddr+((uint32_t)programheader->p_memsz)));
            // first clear the area
            memset((void*)vaddr,0,(uint32_t) programheader->p_memsz);
            // then fill the area with our stuff
            memcpy((void*)vaddr,(void*)poff,(uint32_t) programheader->p_filesz);
        }else if(programheader->p_flags | PF_R ){
            uint32_t vaddr = (uint32_t)programheader->p_vaddr;
            definememoryrange((void*)vaddr,(void*)(vaddr+((uint32_t)programheader->p_memsz)));
            memset((void*)vaddr,0,(uint32_t) programheader->p_filesz);
        }
    }
}

void cpuid(int code, uint32_t *a, uint32_t *d) {
  asm volatile("cpuid":"=a"(*a),"=d"(*d):"a"(code):"ecx","ebx");
}

uint32_t getCR0(){
    uint32_t cr;
    __asm__ __volatile__ (
            "mov %%cr0, %%eax\n\t"
            "mov %%eax, %0\n\t"
        : "=m" (cr)
        : /* no input */
        : "%eax"
    );
    return cr;
}

uint32_t getCR2(){
    uint32_t cr;
    __asm__ __volatile__ (
            "mov %%cr2, %%eax\n\t"
            "mov %%eax, %0\n\t"
        : "=m" (cr)
        : /* no input */
        : "%eax"
    );
    return cr;
}

uint32_t getCR3(){
    uint32_t cr;
    __asm__ __volatile__ (
            "mov %%cr3, %%eax\n\t"
            "mov %%eax, %0\n\t"
        : "=m" (cr)
        : /* no input */
        : "%eax"
    );
    return cr;
}

uint32_t getCR4(){
    uint32_t cr;
    __asm__ __volatile__ (
            "mov %%cr4, %%eax\n\t"
            "mov %%eax, %0\n\t"
        : "=m" (cr)
        : /* no input */
        : "%eax"
    );
    return cr;
}

void setCR0(uint32_t cr){
    __asm__ __volatile__ (
            "mov %0, %%eax\n\t"
            "mov %%eax, %%cr0\n\t"
        : /* no output */
        : "m" (cr)
        : "%eax"
    );
}

void setCR3(uint32_t cr){
    __asm__ __volatile__ (
            "mov %0, %%eax\n\t"
            "mov %%eax, %%cr3\n\t"
        : /* no output */
        : "b" (cr)
        : "%eax"
    );
}

void setCR4(uint32_t cr){
    __asm__ __volatile__ (
            "mov %0, %%eax\n\t"
            "mov %%eax, %%cr4\n\t"
        : /* no output */
        : "b" (cr)
        : "%eax"
    );
}

static inline uint64_t rdmsr(uint32_t msr_id)
{
    uint64_t msr_value;
    asm volatile ( "rdmsr" : "=A" (msr_value) : "c" (msr_id) );
    return msr_value;
}

static inline void wrmsr(uint32_t msr_id, uint64_t msr_value)
{
    asm volatile ( "wrmsr" : : "c" (msr_id), "A" (msr_value) );
}

void enable_64_compat(){
    uint64_t edmsr = rdmsr(0xC0000080);
    wrmsr(0xC0000080,edmsr | (1<<8));
}

void setup_paging(){
    // disable paging...
    uint64_t oldval = table_index;
    k_printf("paging: disable paging\n");
    setCR0(getCR0()&0b01111111111111111111111111111111);

    k_printf("paging: creating pagefile\n");
    table0_index = getPagingAddress();
    k_printf("paging: set CR3 register to our pagefile\n");
    setCR3(table0_index);

    for(int i = 0 ; i < 512 ; i++){
        page_specific_memory_address(i * 0x1000);
    }
    // k_printf("graphics: %x \n",get_graphics_info()->BaseAddress);
    void* uv = ((get_graphics_info()->Width*4) +(get_graphics_info()->Height*get_graphics_info()->PixelsPerScanLine*4) + get_graphics_info()->BaseAddress);
    definememoryrange(get_graphics_info()->BaseAddress,uv);
    definememoryrange((void*) (uint32_t) oldval,(void*) (uint32_t) table_index+0x1000000);

    // enable PAE
    k_printf("paging: set CR4 register to enable PAE\n");
    setCR4(getCR4()|0x20);
    k_printf("paging: enable compatibility mode\n");
    enable_64_compat();
    k_printf("paging: enable paging\n");
    setCR0(getCR0()|(1<<31));
    k_printf("paging: ready\n");
}

extern void gdt_flush();
struct gdt_entry{
    unsigned short limit_low;
    unsigned short base_low;
    unsigned char base_middle;
    unsigned char access;
    unsigned char granularity;
    unsigned char base_high;
} __attribute__((packed));

struct gdt_ptr{
    unsigned short limit;
    unsigned int base;
} __attribute__((packed));

extern uint32_t _LoaderStart;
struct gdt_entry gdt[3];
struct gdt_ptr gp;

void gdt_set_gate(int num, unsigned long base, unsigned long limit, unsigned char access, unsigned char gran){
    /* Setup the descriptor base address */
    gdt[num].base_low = (base & 0xFFFF);
    gdt[num].base_middle = (base >> 16) & 0xFF;
    gdt[num].base_high = (base >> 24) & 0xFF;

    /* Setup the descriptor limits */
    gdt[num].limit_low = (limit & 0xFFFF);
    gdt[num].granularity = ((limit >> 16) & 0x0F);

    /* Finally, set up the granularity and access flags */
    gdt[num].granularity |= (gran & 0xF0);
    gdt[num].access = access;
}

void initialise_gdt_driver(){
    gp.limit = (sizeof(struct gdt_entry) * 3) - 1;
    gp.base = (unsigned long)&gdt;
    gdt_set_gate(0, 0, 0, 0, 0);
    gdt_set_gate(1, 0, 0xFFFFFFFF, 0x9A, 0xCF);
    gdt_set_gate(2, 0, 0xFFFFFFFF, 0x92, 0xCF);
    gdt_flush();
}

void ep_grub(multiboot_info_t *grub, uint32_t magic){
    GraphicsInfo c0;
    GraphicsInfo *c1 = (GraphicsInfo*) &c0;

    c1->BaseAddress = (void*) (uint32_t)grub->framebuffer_addr;
    c1->Width = grub->framebuffer_width;
    c1->Height = grub->framebuffer_height;
    c1->PixelsPerScanLine = c1->Width;
    c1->strategy = 1;

    set_graphics_info(c1);

    initialise_graphics_driver();

    k_printf("\nWelcome to StapelOS chainloader 32bit!\n\n");

    // setup paging
    table_index = 0x550000;
    k_printf("Enabeling paging\n");
    setup_paging();

    k_printf("There are %d available mods!\n",grub->mods_count);
    k_printf("Parameters given: %s \n",grub->cmdline);

    for(multiboot_uint32_t i = 0 ; i < grub->mods_count ; i++){
        k_printf("Inspecting module %d : \n",i);
        struct multiboot_mod_list* mod = (struct multiboot_mod_list*) ( grub->mods_addr + ( sizeof( struct multiboot_mod_list ) * i ) );
        inspectGrubModule(mod);
    }

    // this segment is finished!
    clear_screen(0xFFFFFFFF);

    // tell us memory information:
    // are we capable to support 64 bit?
    k_printf("cpuid: checking if long mode(64bit) is available on this platform!\n");
    uint32_t trashA;
    uint32_t trashB;
    cpuid(0x80000000,&trashA,&trashB);
    if(trashA<0x80000001){
        k_printf("cpuid: extended functions of cpuid are not available and therefore long mode is not available aswel. We are sorry!\n");
        for(;;);
    }
    cpuid(0x80000001,&trashA,&trashB);
    if(!(trashB & (1<<29))){
        k_printf("cpuid: long mode is not supported\n");
        for(;;);
    }
    k_printf("cpuid: long mode is supported\n");

    // print all the memoryfoam
    MemoryDescriptor __attribute__ ((aligned (0x1000)))  db[10];
    memset(&db,0,sizeof(MemoryDescriptor)*10);
    int z = 0;
    for(int i = 0; i < grub->mmap_length;  i += sizeof(multiboot_memory_map_t)) {
        multiboot_memory_map_t* mmmt =  (multiboot_memory_map_t*) (grub->mmap_addr + i);

        if(mmmt->type == MULTIBOOT_MEMORY_AVAILABLE) {
            db[z].Type=7;
            db[z].NumberOfPages = mmmt->len_low / 4096;
            db[z].PhysicalStart = mmmt->addr_low;
            db[z].VirtualStart = mmmt->addr_low;
            k_printf("mem: found %d pages, startring from %x \n",(uint32_t) db[z].NumberOfPages,(uint32_t) db[z].VirtualStart);
            z++;
        }else{
            definememoryrange((void*)mmmt->addr_low,(void*)(mmmt->addr_low+mmmt->size));
            k_printf("mem: from %x to %x is reserved area and is allocated with paging \n",mmmt->addr_low,mmmt->size);
        }

    }

    for(int i = 0 ; i < z ; i++){
      if(db[i].Type==7&&db[i].PhysicalStart){
        db[i].PhysicalStart = table_index;
        db[i].VirtualStart = table_index;
      }
    }

    memoryinfo.mMapDescSize = (uint64_t) sizeof(MemoryDescriptor);
    memoryinfo.mMapSize = (uint64_t) memoryinfo.mMapDescSize*z;
    memoryinfo.mMap = (uint64_t) ((uint32_t)&db);

    graphicsinfo.BaseAddress = (uint64_t) ((uint32_t)grub->framebuffer_addr);
    graphicsinfo.Width = grub->framebuffer_width;
    graphicsinfo.Height = grub->framebuffer_height;
    graphicsinfo.PixelsPerScanLine = graphicsinfo.Width;
    graphicsinfo.strategy = 1;

    bootinfo.font = (uint64_t)0;
    bootinfo.rsdp = (uint64_t)0;
    bootinfo.memory_info = (uint64_t) ((uint32_t)&memoryinfo);
    bootinfo.graphics_info = (uint64_t) ((uint32_t)&graphicsinfo);

    // tell us the loading is finished!
    k_printf("We are ready to do some low level jumps and give control to the 64bit program!\n");
    k_printf("We hand over memory information and graphics information to the kernel\n");
    k_printf("The kernels entry point is at %x\n",kernellocation);
    k_printf("We have pages untill: %x \n",(uint32_t)table_index);

    definememoryrange((void*)0x000000000020e000,(void*)0x000000000021e000);
    // k_printf("EOL!\n");for(;;);
}
